/**
 * Copyright Metrichor Ltd. (An Oxford Nanopore Technologies Company) 2020
 */

"use strict";function t(t){return t&&"object"===typeof t&&"default"in t?t.default:t}var e=t(require("fs-extra")),r=require("lodash"),i=require("os"),o=t(require("path")),n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var a="https://epi2me.nanoporetech.com",l=function(t){function a(i,o){var n=t.call(this,{})||this;n.raiseExceptions=!!o,n.prefsFile=i||a.profilePath(),n.allProfileData={};try{n.allProfileData=r.merge({profiles:{}},e.readJSONSync(n.prefsFile)),n.allProfileData.endpoint&&(n.defaultEndpoint=n.allProfileData.endpoint)}catch(l){if(n.raiseExceptions)throw l}return n}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(a,t),a.profilePath=function(){return o.join(i.homedir(),".epi2me.json")},a.prototype.profile=function(t,i){var o;if(t&&i){r.merge(this.allProfileData,{profiles:(o={},o[t]=i,o)});try{e.writeJSONSync(this.prefsFile,this.allProfileData)}catch(n){if(this.raiseExceptions)throw n}}if(t){if(!this.allProfileData.profiles)throw new Error("cannot read property");return r.merge({endpoint:this.defaultEndpoint},this.allProfileData.profiles[t])}return{}},a}(function(){function t(t){this.allProfileData={},this.defaultEndpoint=process.env.METRICHOR||a,t&&(this.allProfileData=r.merge({profiles:{}},t)),this.allProfileData.endpoint&&(this.defaultEndpoint=this.allProfileData.endpoint)}return t.prototype.profile=function(t){return t?r.merge({endpoint:this.defaultEndpoint},r.merge({profiles:{}},this.allProfileData).profiles[t]):{}},t.prototype.profiles=function(){return Object.keys(this.allProfileData.profiles||{})},t}());module.exports=l;
